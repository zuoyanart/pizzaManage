{"version":3,"sources":["/site/admin/tree/tree.es"],"names":[],"mappings":"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","file":"/site/admin/tree/tree.es","sourcesContent":["/**\r\n * 模块相关操作\r\n * @method\r\n * @param  {[type]} function( [description]\r\n * @return {[type]}           [description]\r\n */\r\nlet tree = (function() {\r\n  let $ = require('jquery');\r\n  let tools = require('pizzatools');\r\n  let common = require('common/common');\r\n  let my = {};\r\n  let options = {\r\n    url: '/admin/tree/',\r\n    tpl: __inline('../ejs/tree.ejs')\r\n  };\r\n\r\n  /**\r\n   * 初始化执行函数\r\n   * @method function\r\n   * @return {[type]} [description]\r\n   */\r\n  my.init = function() {\r\n      eventBind(); //绑定所有交互操作\r\n      page(1);\r\n    }\r\n    /**\r\n     * 编辑模块\r\n     * @method function\r\n     * @param  {[type]} obj [description]\r\n     * @return {[type]}     [description]\r\n     */\r\n  my.get = function() {\r\n      let id = tools.getPara(\"id\");\r\n      if (id == \"\") {\r\n        return;\r\n      }\r\n      $.ajax({\r\n        url: options.url + 'get',\r\n        data: 'id=' + id,\r\n        success: function(msg) {\r\n          console.log(msg.state == true);\r\n          if (msg.state == true) {\r\n            for (let key in msg.msg) {\r\n              $('#' + key).val(msg.msg[key]);\r\n            }\r\n            editor.html(msg.msg.brief);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    /**\r\n     * 编辑模块\r\n     * @method function\r\n     * @param  {[type]} obj [description]\r\n     * @return {[type]}     [description]\r\n     */\r\n  my.edit = function(obj) {\r\n    $(\".form\").pizzaValidate({\r\n      'fields': {\r\n        '#name': {\r\n          'must': true,\r\n          'minLength': 2,\r\n          'maxLength': 48,\r\n          focusMsg: \"请输入标题\",\r\n          errMsg: '标题不能为空或标题必须在2-48个字符之间'\r\n        },\r\n        '#link': {\r\n          'must': false,\r\n          'minLength': 5,\r\n          'maxLength': 150,\r\n          focusMsg: \"请输入自定义链接(非必填)\",\r\n          errMsg: '自定义链接须在5-150个字符之间'\r\n        },\r\n        '#weight': {\r\n          'must': true,\r\n          'minLength': 1,\r\n          'maxLength': 3,\r\n          focusMsg: \"请输入节点权重\",\r\n          errMsg: '请输入节点权重，只能是小于4位的数字'\r\n        }\r\n\r\n      },\r\n      ajaxFun: function(data) {\r\n        let id = tools.getPara(\"id\");\r\n        let pid = tools.getPara('pid');\r\n        let op = \"create\";\r\n        if (id != \"\") {\r\n          op = \"update\";\r\n          data += '&id=' + id;\r\n        } else {\r\n          data += '&pid=' + pid;\r\n        }\r\n        data += '&brief=' + editor.html()\r\n        $.ajax({\r\n          url: options.url + op,\r\n          data: data,\r\n          success: function(msg) {\r\n            if (msg.state == true) {\r\n              history.back();\r\n            }\r\n          }\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  my.pageall = function(callback) {\r\n      $.ajax({\r\n        url: options.url + 'pageall',\r\n        success: function(msg) {\r\n          if (msg.state == true) {\r\n            let s = '<option value=\"1\">首页</option>';\r\n            let data = msg.msg;\r\n            s += fomatNodeList(1, data);\r\n            callback(s);\r\n          }\r\n        }\r\n      })\r\n    }\r\n    /**\r\n     * 递归格式化nodelist\r\n     * @method fomatNodeList\r\n     * @param  {[type]}      pid  [description]\r\n     * @param  {[type]}      data [description]\r\n     * @return {[type]}           [description]\r\n     */\r\n  function fomatNodeList(pid, data) {\r\n    let s = '';\r\n    for (let i = 0, len = data.length; i < len; i++) {\r\n      if (data[i].pid == pid + \"\") {\r\n        s += '<option value=\"' + data[i].id + '\">' + setNodeListGap(data[i].nodepath) + data[i].name + '</option>';\r\n        s += fomatNodeList(data[i].id, data);\r\n      }\r\n    }\r\n    return s;\r\n  }\r\n  /**\r\n   * fomat nodelist 添加制表符\r\n   * @method setNodeListGap\r\n   * @param  {[type]}       nodepath [description]\r\n   */\r\n  function setNodeListGap(nodepath) {\r\n    let l = nodepath.split(',').length - 3;\r\n    let s = '';\r\n    if (l == 0) {\r\n      return s;\r\n    } else {\r\n      s += '├'\r\n      for (let i = 0; i < l; i++) {\r\n        s += '─ ';\r\n      }\r\n      return s;\r\n    }\r\n  }\r\n  /**\r\n   * 获取模块列表\r\n   * @method page\r\n   * @return {[type]} [description]\r\n   */\r\n  function page(pid) {\r\n    let o = $('#' + pid);\r\n    $.ajax({\r\n      url: options.url + 'page',\r\n      data: 'pid=' + pid,\r\n      success: function(msg) {\r\n        let s = new EJS({\r\n            text: options.tpl\r\n        }).render({\r\n            data: msg.msg\r\n        });\r\n        o.after(s);\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * 操作事件绑定\r\n   * @method eventBind\r\n   * @return {[type]}  [description]\r\n   */\r\n  function eventBind() {\r\n    $('#treelist').on('click', 'li > i', function() {\r\n      let o = $(this);\r\n      let cl = o.attr('class');\r\n      let oparent = o.parent();\r\n      let id = oparent.attr('id');\r\n      let subli = $('.pid' + id);\r\n\r\n      if (cl.indexOf('icon-add') > -1) { //展开子集\r\n        o.removeClass('icon-add').addClass('icon-sub');\r\n        if (subli.length > 0) {\r\n          subli.removeClass('display');\r\n        } else {\r\n          page(id);\r\n        }\r\n      } else { //缩回子集\r\n        o.removeClass('icon-sub').addClass('icon-add');\r\n        displaySubNode(oparent, 'hide');\r\n      }\r\n    });\r\n  }\r\n  /**\r\n   * 显示或者隐藏所有子节点\r\n   * @method displaySubNode\r\n   * @param  {[type]}       pidObj [description]\r\n   * @return {[type]}              [description]\r\n   */\r\n  function displaySubNode(pidObj, isdisplay) {\r\n    let node = pidObj.nextAll();\r\n    let nodepath = pidObj.attr('path');\r\n    let subnode;\r\n    let action = {};\r\n    action.show = function(obj) {\r\n      console.log(obj);\r\n      obj.removeClass('display');\r\n    }\r\n    action.hide = function(obj) {\r\n      obj.addClass('display');\r\n      obj.children('i').removeClass('icon-sub').addClass('icon-add');\r\n    }\r\n\r\n    node.each(function() {\r\n      subnode = $(this);\r\n      if ($(this).attr('path').indexOf(nodepath) > -1) {\r\n        action[isdisplay].call(this, subnode);\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  return my;\r\n}());\r\n\r\nmodule.exports = tree;\r\n"]}