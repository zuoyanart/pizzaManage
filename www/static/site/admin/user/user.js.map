{"version":3,"sources":["/site/admin/user/user.es"],"names":[],"mappings":"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","file":"/site/admin/user/user.es","sourcesContent":["/**\r\n * 用户相关操作\r\n * @method\r\n * @param  {[type]} function( [description]\r\n * @return {[type]}           [description]\r\n */\r\nlet user = (function() {\r\n    let $ = require('jquery');\r\n    let tools = require('pizzatools');\r\n    let common = require('common/common');\r\n    require('pizzaui');\r\n    let my = {};\r\n    let options = {\r\n        url: '/admin/user/',\r\n        tpl: __inline('../ejs/user.ejs'),\r\n        cp: 1,\r\n        mp: 20\r\n    };\r\n    let isScroll = true;\r\n\r\n    /**\r\n     * 初始化执行函数\r\n     * @method function\r\n     * @return {[type]} [description]\r\n     */\r\n    my.init = function() {\r\n            eventBind(); //绑定所有交互操作\r\n            page(1); //\r\n            scrollEvent(); //绑定滚动条事件\r\n            common.checkAll('#checkall'); //checkall\r\n\r\n            common.kwSearch('#searchkw', function() {\r\n                page(1);\r\n            });\r\n\r\n\r\n        }\r\n        /**\r\n         * 编辑用户\r\n         * @method function\r\n         * @param  {[type]} obj [description]\r\n         * @return {[type]}     [description]\r\n         */\r\n    my.get = function() {\r\n            let id = tools.getPara(\"id\");\r\n            if (id == \"\") {\r\n                return;\r\n            }\r\n            $.ajax({\r\n                url: options.url + 'get',\r\n                data: 'id=' + id,\r\n                success: function(msg) {\r\n                    if (msg.state == true) {\r\n                        for (let key in msg.msg) {\r\n                            $('#' + key).val(msg.msg[key]);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        /**\r\n         * 编辑用户\r\n         * @method function\r\n         * @param  {[type]} obj [description]\r\n         * @return {[type]}     [description]\r\n         */\r\n    my.edit = function() {\r\n            let id = tools.getPara(\"id\");\r\n            $(\".form\").pizzaValidate({\r\n                'fields': {\r\n                    '#username': {\r\n                        'must': true,\r\n                        'minLength': 3,\r\n                        'maxLength': 20,\r\n                        focusMsg: \"请输入用户名\",\r\n                        errMsg: '用户名必须在3-20个字符之间'\r\n                    },\r\n                    '#nickname': {\r\n                        'must': true,\r\n                        'minLength': 3,\r\n                        'maxLength': 20,\r\n                        focusMsg: \"请输入昵称\",\r\n                        errMsg: '昵称必须在3-20个字符之间'\r\n                    },\r\n                    '#password': {\r\n                        'must': id == '' ? true : false,\r\n                        'minLength': 6,\r\n                        'maxLength': 25,\r\n                        focusMsg: id == '' ? \"请输入密码\" : \"请输入密码,不填写将不更新密码\",\r\n                        errMsg: '密码必须6-25个字符之间'\r\n                    },\r\n                },\r\n                ajaxFun: function(data) {\r\n                    let op = \"create\";\r\n                    if (id != \"\") {\r\n                        op = \"update\";\r\n                        data += \"&id=\" + id;\r\n                    }\r\n                    $.ajax({\r\n                        url: options.url + op,\r\n                        data: data,\r\n                        success: function(msg) {\r\n                            if (msg.state == true) {\r\n                                history.back();\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        /**\r\n         * 获取用户列表\r\n         * @method page\r\n         * @return {[type]} [description]\r\n         */\r\n    function page(cp, mp) {\r\n        if (cp) {\r\n            options.cp = cp;\r\n        }\r\n        $.ajax({\r\n            url: options.url + 'page',\r\n            data: 'cp=' + options.cp + '&mp=' + options.mp + '&kw=' + $.trim($('#searchkw').val()),\r\n            success: function(msg) {\r\n                let s = new EJS({\r\n                    text: options.tpl\r\n                }).render({\r\n                    data: msg.msg\r\n                });\r\n\r\n                if (cp == 1) {\r\n                    $('#list').html(s);\r\n                } else {\r\n                    $('#list').append(s);\r\n                }\r\n                options.cp += 1;\r\n                isScroll = true;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * 操作事件绑定\r\n     * @method eventBind\r\n     * @return {[type]}  [description]\r\n     */\r\n    function eventBind() {\r\n        $('#list').on('click', 'li > span > i', function() {\r\n            let cl = $(this).attr('class');\r\n            if (cl) {\r\n                action[cl].call(this, $(this));\r\n            }\r\n        });\r\n        $('#main > div.menu').on('click', 'em', function() {\r\n            let cl = $(this).attr('class');\r\n            if (cl) {\r\n                action[cl].call(this, $(this));\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * 滚动条滚动事件\r\n     * @method scrollEvent\r\n     * @return {[type]}    [description]\r\n     */\r\n    function scrollEvent() {\r\n        $(window).scroll(function() {\r\n            let docHeight = document.body.scrollHeight;\r\n            let scrollTop = 0; //滚动条高度\r\n            if (document.documentElement && document.documentElement.scrollTop) {\r\n                scrollTop = document.documentElement.scrollTop;\r\n            } else if (document.body) {\r\n                scrollTop = document.body.scrollTop;\r\n            }\r\n            let bottomHeight = docHeight - scrollTop - $(window).height();\r\n            //console.log(bottomHeight);\r\n            //console.log(isScroll);\r\n            if (bottomHeight < 100 && isScroll == true) {\r\n                page();\r\n                isScroll = false;\r\n            }\r\n        });\r\n    }\r\n    /////action\r\n    let action = {};\r\n    /**\r\n     *\r\n     * @method remove\r\n     * @return {[type]} [description]\r\n     */\r\n    action.remove = function(obj) {\r\n            let id = common.getCheckId(obj);\r\n            if (id == '0') {\r\n                return;\r\n            }\r\n            $.ajax({\r\n                url: options.url + 'remove',\r\n                data: 'id=' + id,\r\n                success: function(msg) {\r\n                    if (msg.state == true) {\r\n                        let ids = id.split(',');\r\n                        for (let i = 0, ll = ids.length; i < ll; i++) {\r\n                            $('#user_' + ids[i]).parent().parent().remove();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        /**\r\n         * 冻结用户\r\n         * @method function\r\n         * @return {[type]} [description]\r\n         */\r\n    action.pass = function(obj) {\r\n        let id = common.getCheckId(obj);\r\n        if (id == '0') {\r\n            return;\r\n        }\r\n        let ispass = \"false\";\r\n        if (obj.html() == '冻结') {\r\n            ispass = \"true\";\r\n        }\r\n        $.ajax({\r\n            url: options.url + 'pass',\r\n            data: 'id=' + id + '&ispass=' + ispass,\r\n            success: function(msg) {\r\n                if (msg.state == true) {\r\n                    let ids = id.split(',');\r\n                    if (ispass == \"true\") { //冻结\r\n                        for (let i = 0, ll = ids.length; i < ll; i++) {\r\n                            let oo = $('#' + ids[i]).parent().parent();\r\n                            if (oo.children(\"b\").length == 0) {\r\n                                oo.children('a').after('<b>[已冻结]</b>');\r\n                            }\r\n                            oo.find('i.pass').html('取消冻结');\r\n                        }\r\n                    } else { //取消冻结\r\n                        for (let i = 0, ll = ids.length; i < ll; i++) {\r\n                            let oo = $('#' + ids[i]).parent().parent();\r\n                            oo.find('b').remove();\r\n                            oo.find('i.pass').html('冻结');\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    return my;\r\n}());\r\n\r\nmodule.exports = user;\r\n"]}