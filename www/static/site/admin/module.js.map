{"version":3,"sources":["/site/admin/module.es"],"names":[],"mappings":"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","file":"/site/admin/module.es","sourcesContent":["/**\r\n * 模块相关操作\r\n * @method\r\n * @param  {[type]} function( [description]\r\n * @return {[type]}           [description]\r\n */\r\nlet block = (function() {\r\n    let $ = require('jquery');\r\n    let tools = require('pizzatools');\r\n    let common = require('common/common');\r\n    let my = {};\r\n    let options = {\r\n        url: '/admin/block/',\r\n        tpl: __inline('./ejs/block.ejs'),\r\n        cp: 1,\r\n        mp: 20\r\n    };\r\n    let isScroll = true;\r\n\r\n    /**\r\n     * 初始化执行函数\r\n     * @method function\r\n     * @return {[type]} [description]\r\n     */\r\n    my.init = function() {\r\n            eventBind(); //绑定所有交互操作\r\n            page(1); //\r\n            scrollEvent(); //绑定滚动条事件\r\n            common.checkAll('#checkall'); //checkall\r\n            common.kwSearch('#searchkw', function() {\r\n                page(1);\r\n            });\r\n        }\r\n        /**\r\n         * 编辑模块\r\n         * @method function\r\n         * @param  {[type]} obj [description]\r\n         * @return {[type]}     [description]\r\n         */\r\n    my.get = function() {\r\n            let id = tools.getPara(\"id\");\r\n            if (id == \"\") {\r\n                return;\r\n            }\r\n            $.ajax({\r\n                url: options.url + 'get',\r\n                data: 'id=' + id,\r\n                success: function(msg) {\r\n                    if (msg.state == true) {\r\n                        for (let key in msg.msg) {\r\n                            $('#' + key).val(msg.msg[key]);\r\n                        }\r\n                        editor.html(msg.msg.content);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        /**\r\n         * 编辑模块\r\n         * @method function\r\n         * @param  {[type]} obj [description]\r\n         * @return {[type]}     [description]\r\n         */\r\n    my.edit = function(obj) {\r\n            $(\".form\").pizzaValidate({\r\n                'fields': {\r\n                    '#title': {\r\n                        'must': true,\r\n                        'minLength': 5,\r\n                        'maxLength': 48,\r\n                        focusMsg: \"请输入标题\",\r\n                        errMsg: '标题不能为空或标题必须在5-48个字符之间'\r\n                    }\r\n                },\r\n                ajaxFun: function(data) {\r\n                    let id = tools.getPara(\"id\");\r\n                    let op = \"create\";\r\n                    if (id != \"\") {\r\n                        op = \"update\";\r\n                        data += \"&id=\" + id;\r\n                    }\r\n                    data += '&content=' + editor.html()\r\n                    $.ajax({\r\n                        url: options.url + op,\r\n                        data: data,\r\n                        success: function(msg) {\r\n                            if (msg.state == true) {\r\n                                history.back();\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        }\r\n        /**\r\n         * 获取模块列表\r\n         * @method page\r\n         * @return {[type]} [description]\r\n         */\r\n    function page(cp, mp) {\r\n        if (cp) {\r\n            options.cp = cp;\r\n        }\r\n        $.ajax({\r\n            url: options.url + 'page',\r\n            data: 'cp=' + options.cp + '&mp=' + options.mp + '&kw=' + $.trim($('#searchkw').val()),\r\n            success: function(msg) {\r\n                let s = new EJS({\r\n                    text: options.tpl\r\n                }).render({\r\n                    data: msg.msg\r\n                });\r\n\r\n                if (cp == 1) {\r\n                    $('#list').html(s);\r\n                } else {\r\n                    $('#list').append(s);\r\n                }\r\n                options.cp += 1;\r\n                isScroll = true;\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * 操作事件绑定\r\n     * @method eventBind\r\n     * @return {[type]}  [description]\r\n     */\r\n    function eventBind() {\r\n        $('#list').on('click', 'li > span > i', function() {\r\n            let cl = $(this).attr('class');\r\n            console.log(cl);\r\n            if (cl) {\r\n                action[cl].call(this, $(this));\r\n            }\r\n        });\r\n        $('#main > div.menu').on('click', 'em', function() {\r\n            let cl = $(this).attr('class');\r\n            if (cl) {\r\n                action[cl].call(this, $(this));\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * 滚动条滚动事件\r\n     * @method scrollEvent\r\n     * @return {[type]}    [description]\r\n     */\r\n    function scrollEvent() {\r\n        $(window).scroll(function() {\r\n            let docHeight = document.body.scrollHeight;\r\n            let scrollTop = 0; //滚动条高度\r\n            if (document.documentElement && document.documentElement.scrollTop) {\r\n                scrollTop = document.documentElement.scrollTop;\r\n            } else if (document.body) {\r\n                scrollTop = document.body.scrollTop;\r\n            }\r\n            let bottomHeight = docHeight - scrollTop - $(window).height();\r\n            //console.log(bottomHeight);\r\n            //console.log(isScroll);\r\n            if (bottomHeight < 100 && isScroll == true) {\r\n                page();\r\n                isScroll = false;\r\n            }\r\n        });\r\n    }\r\n    /////action\r\n    let action = {};\r\n    /**\r\n     *\r\n     * @method remove\r\n     * @return {[type]} [description]\r\n     */\r\n    action.remove = function(obj) {\r\n        let id = common.getCheckId(obj);\r\n        if (id == '0') {\r\n            return;\r\n        }\r\n        layer.confirm(\"确定要删除该模块吗？\", {\r\n            icon: 3,\r\n            title: '警告'\r\n        }, function(index) {\r\n            $.ajax({\r\n                url: options.url + 'remove',\r\n                data: 'id=' + id,\r\n                success: function(msg) {\r\n                    if (msg.state == true) {\r\n                        let ids = id.split(',');\r\n                        layer.close(index);\r\n                        for (let i = 0, ll = ids.length; i < ll; i++) {\r\n                            $('#block_' + ids[i]).parent().parent().remove();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n\r\n    return my;\r\n}());\r\n\r\nmodule.exports = block;\r\n"]}